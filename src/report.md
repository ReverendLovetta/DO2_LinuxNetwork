# Сети в Linux

## Part 1. Инструмент ipcalc
---
- **1.1. Сети и маски**:
- 1) Адрес сети 192.167.38.54/13: 
- С помощью команды `ipcalc 192.167.38.54/13` определим адрес сети:
- ![Адрес сети 192.167.38.54/13:](./screenshots/1.png)
- Адрес сети: 192.160.0.0
- 2) Перевод маски 255.255.255.0 в префиксную и двоичную запись: /24, 11111111.11111111.11111111.00000000
- Перевод маски /15 в обычную и двоичную запись: 255.254.0.0, 11111111.1111111 0.00000000.00000000
- Перевод маски 11111111.11111111.11111111.1111 0000 в обычную и префиксную: 255.255.255.240, /28
- **1.2. localhost**:
- Для приложений, работающих на localhost, выделяют следующий диапазон IP-адресов, через которых к ним можно обратиться: 127.0.0.1 - 127.255.255.254. Так что из перечсленны IP-адресов: 194.34.23.100*, *127.0.0.2*, *127.1.0.1*, *128.0.0.1*, подходят только *127.0.0.2* и *127.1.0.1*
- **1.3. Диапазоны и сегменты сетей**:
- 1) Из перечисленных IP-адресов: *10.0.0.45*, *134.43.0.2*, *192.168.4.2*, *172.20.250.4*, *172.0.2.1*, *192.172.0.1*, *172.68.0.2*, *172.16.255.255*, *10.10.10.10*, *192.169.168.1*
- В качестве частных можно использовать: *10.0.0.45*, *192.168.4.2*, *172.20.250.4*, *172.16.255.255*, *10.10.10.10*
- В качестве публичных можно использовать: *134.43.0.2*, *172.0.2.1*, *192.172.0.1*, *172.68.0.2*, *192.169.168.1*
- 2) Для сети 10.10.0.0/18* HostMin: 10.10.0.1, HostMax: 10.10.63.254. Для нее возможно следующие IP-адреса: *10.0.0.1*, *10.10.0.2*, *10.10.10.10*
---
## Part 2. Статическая маршрутизация между двумя машинами
---
- Результат работы команды `ip a` для обеих машин:
- Для ws-1:
- ![`ip a` для ws-1:](./screenshots/2.png)
- Для ws-2:
- ![`ip a` для ws-2:](./screenshots/3.png)
\> *Сетевой интерфейс - программное обеспечение, взаимодействующее с сетевым драйвером и с уровнем IP. Сетевой интерфейс обеспичивает уровню IP доступ ко всем имеющим сетевым адаптерам*
- Добавим для каждой машины по сетевому интерфейсу для работы с внтутренней сетью, через virtualBox.
- Проверим наличие нового сетевого интерфейса для ws-1 при помощи команды `ip a`:
- ![ip a](./screenshots/4.png)
- Проверим наличие нового сетевого интерфейса для ws-2 при помощи команды `ip a`:
- ![ip a](./screenshots/5.png)
- В данном случае для обеих машин это интерфейс enp0s8.
- Зададим соответствующие адреса и маски для машин ws-1 и ws-2 - *192.168.100.10*, маска */16*, ws2 - *172.24.116.8*, маска */12*:
- для ws-1:
- Отредактируем файл */etc/netplan/00-installer-config.yaml*
- ![/etc/netplan/00-installer-config.yaml](./screenshots/6.png)
- Перезапустим сервис сети с помощью команды `netplan apply`
- ![netplan apply:](./screenshots/6.1.png)
- С помощью команды `ip r` увидим изменения:
- ![ip r](./screenshots/7.png)
- для ws-2:
- Отредактируем файл */etc/netplan/00-installer-config.yaml*
- ![/etc/netplan/00-installer-config.yaml](./screenshots/8.png)
- Перезапустим сервис сети с помощью команды `netplan apply`
- ![netplan apply:](./screenshots/8.1.png)
- С помощью команды `ip r` увидим изменения:
- ![ip r](./screenshots/9.png)
- **2.1. Добавление статического маршрута вручную:**
- При добавлении интерфейса для внутренней сети выше для обеих виртуальных машин необходимо было в настройках обеих назвать внутреннюю сеть одинакого. 
- Добавим путь от машины ws-1 к ws-2 с помощью команды `sudo ip r add "IP-адрес сети" dev "название интерфейса"`:
- для ws-1:
- ![от ws-1 до ws-2](./screenshots/10.png)
- для ws-2:
- ![от ws-2 до ws-1](./screenshots/11.png)
- **2.2. Добавление статического маршрута с сохранением:**
- После перезагрузки машин добавим статический маршрут от одной до другой с помощью файла */etc/netplan/00-installer-config.yaml*:
- для ws-1:
- ![добавление статического маршрута для ws-1:](./screenshots/12.png)
- для ws-2:
- ![Добавление статического маршрута для ws-2:](./screenshots/13.png)
- Пропингуем соединение между машинами:
- от ws-1 к ws-2:
- ![ping ws-2](./screenshots/14.png)
- от ws-2 к ws-1:
- ![ping ws-1](./screenshots/15.png)
---
## Part 3. Утилита **iperf3**
---
- **3.1. Скорость соединения:**
- Переведем следующие величины:
- 8 Mbps = 1 MB/s
- 100 MB/s = 800000 Kbps
- 1 Gbps = 1000 Mbps
- **3.2. Утилита **iperf3:**
- Измерим скорость соединения между ws-1 и ws-2:
- Для этого воспользуемся утилитовй **iperf3**:
- Для начала установим на обе машины программу с помощью команды `sudo apt install iperf3`.
- После зайдем на ws-2 (в данный момент она будет выступать сервером) и запустим серверную часть программы с помощью команды `iperf3 -s -f M`:
- ![запуск серверной части программы iperf3:](./screenshots/16.png)
- Далее переключимся на машину ws-1 (в данный момент она будет выступать клиентом) и запусит клиентскую часть программы `iperf3 -c 172.24.116.8 -f M`:
- ![запуск клиентской части программы iperf3](./screenshots/17.png)
- Далее сделаем то же самое, только поменяем роли для машин:
- Зайдем на ws-1 (в данный момент она будет выступать сервером) и запустим серверную часть программы с помощью команды `iperf3 -s -f M`:
- ![запуск серверной части программы iperf3:](./screenshots/18.png)
- Далее переключимся на машину ws-2 (в данный момент она будет выступать клиентом) и запусит клиентскую часть программы `iperf3 -c 192.168.100.10 -f M`:
- ![запуск клиентской части программы iperf3](./screenshots/19.png)
---
## Part 4. Сетевой экран
---
- **4.1. Утилита iptables:**
- Создадим файл */etc/firewall.sh*, имитирующий фаерволл, на ws1 и ws2: